CREATE TABLE pickup_count_by_hour AS
SELECT pickup_gid, EXTRACT(hour FROM pickup_datetime) AS pickup_hour, COUNT(*) / 365.0 AS count_mean_pickup
FROM trip, trip_nta
WHERE trip_nta.trip_id=trip.trip_id
GROUP BY pickup_gid, pickup_hour
ORDER BY pickup_gid, pickup_hour; 

CREATE TABLE dropoff_count_by_hour AS
SELECT dropoff_gid, EXTRACT(hour FROM dropoff_datetime) AS dropoff_hour, COUNT(*) / 365.0 AS count_mean_dropoff
FROM trip, trip_nta
WHERE trip_nta.trip_id=trip.trip_id
GROUP BY dropoff_gid, dropoff_hour
ORDER BY dropoff_gid, dropoff_hour; 

CREATE TABLE count_by_hour AS
SELECT *
FROM pickup_count_by_hour
FULL OUTER JOIN dropoff_count_by_hour
ON pickup_gid=dropoff_gid AND pickup_hour=dropoff_hour;

DROP TABLE pickup_count_by_hour;
DROP TABLE dropoff_count_by_hour;

ALTER TABLE count_by_hour ALTER pickup_hour TYPE integer;
ALTER TABLE count_by_hour ALTER dropoff_hour TYPE integer;

ALTER TABLE count_by_hour RENAME TO count_by_hour_nta;

#################################
CREATE TABLE pickup_count_by_hour_ct AS
SELECT pickup_gid, EXTRACT(hour FROM pickup_datetime) AS pickup_hour, COUNT(*) / 365.0 AS count_mean_pickup
FROM trip, trip_ct
WHERE trip_ct.trip_id=trip.trip_id
GROUP BY pickup_gid, pickup_hour
ORDER BY pickup_gid, pickup_hour; 

CREATE TABLE dropoff_count_by_hour_ct AS
SELECT dropoff_gid, EXTRACT(hour FROM dropoff_datetime) AS dropoff_hour, COUNT(*) / 365.0 AS count_mean_dropoff
FROM trip, trip_ct
WHERE trip_ct.trip_id=trip.trip_id
GROUP BY dropoff_gid, dropoff_hour
ORDER BY dropoff_gid, dropoff_hour; 

CREATE TABLE count_by_hour_ct AS
SELECT *
FROM pickup_count_by_hour_ct
FULL OUTER JOIN dropoff_count_by_hour_ct
ON pickup_gid=dropoff_gid AND pickup_hour=dropoff_hour;
